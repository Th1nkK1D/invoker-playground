(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{Btgg:function(e){e.exports=JSON.parse('{"space":32,"q":81,"w":87,"e":69,"r":82}')},iyQ6:function(e,t,n){"use strict";n.r(t);n("fbCW"),n("2B1R"),n("sMBO"),n("rB9j"),n("EnZy"),n("TeQF"),n("pDQq"),n("tkto");var i=n("ODXe"),r=n("/1fb"),s=n.n(r),o=(n("R5XZ"),n("piMb"),n("ToJy"),n("KQm4")),a=n("1OyB"),l=n("vuIU"),c=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Object(a.a)(this,e),this.name=t,this.icon=i,this.requiredOrbs=e.sortOrbs(n).map((function(e){return e}))}return Object(l.a)(e,null,[{key:"sortOrbs",value:function(e){return Object(o.a)(e).sort((function(e,t){return e.key.localeCompare(t.key)}))}}]),Object(l.a)(e,[{key:"isFulFilledWith",value:function(t){var n=this;return e.sortOrbs(t).every((function(e,t){return e.isEqualTo(n.requiredOrbs[t])}))}},{key:"isEqualTo",value:function(e){return e&&e.name&&e.name===this.name}}]),e}(),u={name:"SpellBar",props:{spell:c},methods:{triggerContainerClass:function(e){var t=this;this.$refs.container.classList.add(e),setTimeout((function(){return t.$refs.container.classList.remove(e)}),500)},triggerValidInvoke:function(){this.triggerContainerClass("bg-green-500")},triggerInvalidInvoke:function(){this.triggerContainerClass("bg-red-500")}}},d=n("KHd+"),h=Object(d.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"container",staticClass:"flex flex-row bg-white h-12 max-w-md m-auto rounded-full p-1 shadow-md\n  transition-colors duration-500 ease-in-out"},[e.spell?n("img",{staticClass:"h-full rounded-full",attrs:{src:e.spell.icon,alt:e.spell.name,role:"img"}}):e._e(),n("div",{staticClass:"flex-1 flex flex-col justify-center"},[n("div",{staticClass:"text-black font-bold"},[e._v("\n      "+e._s(e.spell?e.spell.name:"Press space to start")+"\n    ")]),e.spell?e._e():n("div",{staticClass:"text-xs text-gray-500"},[e._v("\n      Q, W, E to cast Quas, Wex and Exort - R to invoke\n    ")])]),e.spell?n("div",{staticClass:"w-10"}):e._e()])}),[],!1,null,null,null).exports,v=(n("ma9I"),n("+2oP"),n("Rfxz"),n("T5bk")),f=function(){function e(t){Object(a.a)(this,e),this.activeOrbs=[null,null,null],this.spells=t}return Object(l.a)(e,[{key:"castOrb",value:function(e){var t=Object(v.a)(this.activeOrbs).slice(1);this.activeOrbs=[].concat(Object(o.a)(t),[e])}},{key:"invoke",value:function(){var e=this;return this.activeOrbs.some((function(e){return null===e}))?null:this.spells.find((function(t){return t.isFulFilledWith(e.activeOrbs)}))}}]),e}(),p=n("Btgg"),m=(n("QWBl"),n("07d7"),n("OM9Z"),n("FZtP"),n("Womt")),b=n("vS4O"),g=n.n(b),y=n("IrXD"),x=n("VTBJ");n("oVuX");function O(e,t,n){var r=e.geometry.clone();!function(e,t){var n=new Array(e.vertices.length);e.faces.forEach((function(e){if(e instanceof m.Face4){var t=Object(i.a)(e.vertexNormals,4);n[e.a]=t[0],n[e.b]=t[1],n[e.c]=t[2],n[e.d]=t[3]}else if(e instanceof m.Face3){var r=Object(i.a)(e.vertexNormals,3);n[e.a]=r[0],n[e.b]=r[1],n[e.c]=r[2]}})),e.vertices.map((function(e,i){var r=n[i];return Object(x.a)(Object(x.a)({},e),{},{x:e.x+r.x*t,y:e.y+r.y*t,z:e.z+r.z*t})}))}(r,t);var s,o,a=(s=["varying vec3 vVertexWorldPosition;","varying vec3 vVertexNormal;","varying vec4 vFragColor;","void main(){"," vVertexNormal = normalize(normalMatrix * normal);"," vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;"," // set gl_Position"," gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),o=["uniform vec3 glowColor;","uniform float coeficient;","uniform float power;","varying vec3 vVertexNormal;","varying vec3 vVertexWorldPosition;","varying vec4 vFragColor;","void main(){"," vec3 worldCameraToVertex= vVertexWorldPosition - cameraPosition;"," vec3 viewCameraToVertex = (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;"," viewCameraToVertex = normalize(viewCameraToVertex);"," float intensity = pow(coeficient + dot(vVertexNormal, viewCameraToVertex), power);"," gl_FragColor = vec4(glowColor, intensity);","}"].join("\n"),new m.ShaderMaterial({uniforms:{coeficient:{type:"f",value:1},power:{type:"f",value:2},glowColor:{type:"c",value:new m.Color("pink")}},vertexShader:s,fragmentShader:o,transparent:!0,depthWrite:!1})),l=n.color,c=n.coeficient,u=n.power,d=n.side;return a.uniforms.glowColor.value=new m.Color(l),a.uniforms.coeficient.value=c,a.uniforms.power.value=u,d&&(a.side=d),new m.Mesh(r,a)}var w,k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cyan",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=new m.Object3D,s=O(e,.01,Object(x.a)({color:t,coeficient:1.1,power:1.4},n));r.add(s);var o=O(e,.1,Object(x.a)({color:t,coeficient:.1,power:1.2,back:m.BackSide},i));r.add(o),this.object3d=r,this.insideMesh=s,this.outsideMesh=o},C=function(){function e(t,n){var i;Object(a.a)(this,e),this.scene=new m.Scene,this.loader=new g.a,this.renderer=new m.WebGLRenderer,this.renderer.setSize(t,n),this.clock=new m.Clock,this.invokerAnimationMixer=null,this.invokerAnimationClips=[],this.orbs=[new m.Object3D,new m.Object3D,new m.Object3D],this.orbs[0].position.setX(-3).setY(4).setZ(-1),this.orbs[1].position.setX(0).setY(7.5).setZ(-1),this.orbs[2].position.setX(3).setY(4).setZ(-1),(i=this.scene).add.apply(i,Object(o.a)(this.orbs)),this.nextOrbIndex=0,this.nextCastedHand="l"}return Object(l.a)(e,[{key:"render",value:function(e){var t=this;return new Promise((function(n){t.loader.load("".concat("/invoker-playground","/models/invoker.glb"),(function(r){var s;(s=t.scene).add.apply(s,Object(o.a)(r.scene.children));var a=Object(i.a)(r.cameras,1);t.camera=a[0],t.invokerAnimationClips=r.animations,t.invokerAnimationMixer=new m.AnimationMixer(t.scene.getObjectByName("invoker")),t.getAnimationAction("idle").play(),e.appendChild(t.renderer.domElement),t.orbs.forEach((function(e,t){new y.a.Tween(e.position).to({y:e.position.y+.2},2e3).repeat(1/0).yoyo(!0).delay(1e3*t).repeatDelay(0).easing(y.a.Easing.Quadratic.InOut).start()})),t.animate(),n()}))}))}},{key:"animate",value:function(){var e=this;requestAnimationFrame((function(){return e.animate()})),null!==this.invokerAnimationMixer&&this.invokerAnimationMixer.update(this.clock.getDelta()),y.a.update(),this.renderer.render(this.scene,this.camera)}},{key:"pushOrb",value:function(t){this.getAnimationAction("cast_".concat(this.nextCastedHand)).stop().setLoop(m.LoopOnce).play();var n=this.orbs[this.nextOrbIndex];n.children&&n.children.pop(),n.add(e.generateOrbMesh(t)),this.nextOrbIndex=(this.nextOrbIndex+1)%3,this.nextCastedHand="l"===this.nextCastedHand?"r":"l"}},{key:"invoke",value:function(){this.getAnimationAction("invoke").stop().setLoop(m.LoopOnce).play()}},{key:"getAnimationAction",value:function(e){return this.invokerAnimationMixer.clipAction(m.AnimationClip.findByName(this.invokerAnimationClips,e))}}],[{key:"generateOrbMesh",value:function(e){var t=new m.Mesh(new m.SphereGeometry(.5),new m.MeshBasicMaterial({color:"white"})),n=new k(t,e);return t.add(n.object3d),t}}]),e}(),j={name:"ModelScene",data:function(){return{sceneController:null,SCREEN_WIDTH:500,SCREEN_HEIGHT:500,isLoading:!0}},mounted:function(){var e=this;this.sceneController=new C(this.SCREEN_WIDTH,this.SCREEN_HEIGHT),this.sceneController.render(this.$refs.scene).then((function(){e.isLoading=!1}))},methods:{pushOrb:function(e){this.sceneController.pushOrb(e.color)},invoke:function(){this.sceneController.invoke()}}},S=Object(d.a)(j,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{ref:"scene",staticClass:"flex justify-center"},[this.isLoading?t("div",{staticClass:"flex flex-col justify-center",style:"width: "+this.SCREEN_WIDTH+"px; height: "+this.SCREEN_HEIGHT+"px;"},[this._v("\n    Summoning Invoker...\n  ")]):this._e()])}),[],!1,null,null,null).exports,E={name:"GameArea",components:{SpellBar:h,Keypress:s.a,ModelScene:S},props:{orbs:{type:Array,default:function(){return[]}},spells:{type:Array,default:function(){return[]}}},data:function(){return{watchedKeys:[{code:p.space,handler:this.onStartPressed},{code:p.q,handler:this.onOrbPressed},{code:p.w,handler:this.onOrbPressed},{code:p.e,handler:this.onOrbPressed},{code:p.r,handler:this.onInvokePressed}],targetSpell:null}},computed:{isStarted:function(){return null!==this.targetSpell}},methods:{getNextTargetSpell:function(){var e=this,t=this.spells.filter((function(t){return t!==e.targetSpell})),n=Math.floor(Math.random()*t.length),r=t.splice(n,1),s=Object(i.a)(r,1);this.targetSpell=s[0]},onStartPressed:function(){this.isStarted||(w=new f(this.spells),this.getNextTargetSpell())},onOrbPressed:function(e){if(this.isStarted){var t=Object.keys(p).find((function(t){return p[t]===e})),n=this.orbs.find((function(e){return e.key===t}));w.castOrb(n),this.$refs.modelScene.pushOrb(n)}},onInvokePressed:function(){if(this.isStarted){var e=w.invoke();this.$refs.modelScene.invoke(),e&&e.isEqualTo(this.targetSpell)?(this.$refs.spellBar.triggerValidInvoke(),this.getNextTargetSpell()):this.$refs.spellBar.triggerInvalidInvoke()}}}},M=Object(d.a)(E,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("ModelScene",{ref:"modelScene"}),t("SpellBar",{ref:"spellBar",attrs:{"data-testId":"spellBar",spell:this.targetSpell}}),this._l(this.watchedKeys,(function(e){return t("Keypress",{key:e.code,attrs:{"key-code":e.code,event:"keydown"},on:{pressed:e.handler}})}))],2)}),[],!1,null,null,null).exports,_=function(){function e(t,n,i){Object(a.a)(this,e),this.name=t,this.key=n,this.color=i}return Object(l.a)(e,[{key:"isEqualTo",value:function(e){var t=e.key;return this.key===t}}]),e}(),A={components:{GameArea:M},data:function(){return{orbs:[],spells:[]}},mounted:function(){var e=this;this.orbs=this.$page.orbs.edges[0].node.data.map((function(e){var t=e.name,n=e.key,i=e.color;return new _(t,n,+i)})),this.spells=this.$page.spells.edges[0].node.data.map((function(t){var n=t.name,i=t.requiredOrbs,r=t.icon;return new c(n,i.split("").map((function(t){return e.orbs.find((function(e){return e.key===t}))})),r)}))}},T=null,I=Object(d.a)(A,(function(){var e=this.$createElement,t=this._self._c||e;return t("Layout",[t("div",{staticClass:"h-full flex flex-col justify-center text-center text-white"},[t("GameArea",{attrs:{orbs:this.orbs,spells:this.spells}})],1)])}),[],!1,null,null,null);"function"==typeof T&&T(I);t.default=I.exports}}]);